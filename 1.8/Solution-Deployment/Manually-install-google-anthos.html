<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Manually Install and configure Google Anthos 1.8 | HPE SOLUTION FOR GOOGLE ANTHOS 1.8 ON HPE INFRASTRUCTURE</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Hewlett Packard Enterprise">
    
    <link rel="preload" href="/hpe-solutions-googleanthos/1.8/assets/css/0.styles.279d5301.css" as="style"><link rel="preload" href="/hpe-solutions-googleanthos/1.8/assets/js/app.9bbc654e.js" as="script"><link rel="preload" href="/hpe-solutions-googleanthos/1.8/assets/js/2.0cd4e70b.js" as="script"><link rel="preload" href="/hpe-solutions-googleanthos/1.8/assets/js/7.05a6c413.js" as="script"><link rel="prefetch" href="/hpe-solutions-googleanthos/1.8/assets/js/10.93104643.js"><link rel="prefetch" href="/hpe-solutions-googleanthos/1.8/assets/js/11.456baf98.js"><link rel="prefetch" href="/hpe-solutions-googleanthos/1.8/assets/js/12.76e7a57a.js"><link rel="prefetch" href="/hpe-solutions-googleanthos/1.8/assets/js/13.58910a84.js"><link rel="prefetch" href="/hpe-solutions-googleanthos/1.8/assets/js/14.0201a349.js"><link rel="prefetch" href="/hpe-solutions-googleanthos/1.8/assets/js/15.412c5f48.js"><link rel="prefetch" href="/hpe-solutions-googleanthos/1.8/assets/js/16.47ac5a1b.js"><link rel="prefetch" href="/hpe-solutions-googleanthos/1.8/assets/js/17.a36be225.js"><link rel="prefetch" href="/hpe-solutions-googleanthos/1.8/assets/js/18.056d5bce.js"><link rel="prefetch" href="/hpe-solutions-googleanthos/1.8/assets/js/19.9aa09ada.js"><link rel="prefetch" href="/hpe-solutions-googleanthos/1.8/assets/js/3.8475c6c0.js"><link rel="prefetch" href="/hpe-solutions-googleanthos/1.8/assets/js/4.5a8c2944.js"><link rel="prefetch" href="/hpe-solutions-googleanthos/1.8/assets/js/5.20062654.js"><link rel="prefetch" href="/hpe-solutions-googleanthos/1.8/assets/js/6.fd2018e6.js"><link rel="prefetch" href="/hpe-solutions-googleanthos/1.8/assets/js/8.9aedf684.js"><link rel="prefetch" href="/hpe-solutions-googleanthos/1.8/assets/js/9.533d369a.js">
    <link rel="stylesheet" href="/hpe-solutions-googleanthos/1.8/assets/css/0.styles.279d5301.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-googleanthos/1.8/" class="home-link router-link-active"><!----> <span class="site-name">HPE SOLUTION FOR GOOGLE ANTHOS 1.8 ON HPE INFRASTRUCTURE</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-googleanthos/1.8/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-googleanthos/1.8/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Google Anthos On HPE Infrastructure</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Solution Deployment</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hpe-solutions-googleanthos/1.8/Solution-Deployment/Solution-deployment-flow.html" class="sidebar-link">Solution Deployment Flow</a></li><li><a href="/hpe-solutions-googleanthos/1.8/Solution-Deployment/Preparing-execution-environment.html" class="sidebar-link">Preparing the execution environment</a></li><li><a href="/hpe-solutions-googleanthos/1.8/Solution-Deployment/Operating-system-deployment.html" class="sidebar-link">Deploying operating system on bare-metal nodes</a></li><li><a href="/hpe-solutions-googleanthos/1.8/Solution-Deployment/Host-configuration.html" class="sidebar-link">Host Configuration</a></li><li><a href="/hpe-solutions-googleanthos/1.8/Solution-Deployment/Manually-install-google-anthos.html" aria-current="page" class="active sidebar-link">Manually Install and configure Google Anthos 1.8</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hpe-solutions-googleanthos/1.8/Solution-Deployment/Manually-install-google-anthos.html#creating-admin-cluster" class="sidebar-link">Creating Admin Cluster</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-googleanthos/1.8/Solution-Deployment/Manually-install-google-anthos.html#creating-user-cluster" class="sidebar-link">Creating User Cluster</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="manually-install-and-configure-google-anthos-1-8"><a href="#manually-install-and-configure-google-anthos-1-8" class="header-anchor">#</a> Manually Install and configure Google Anthos 1.8</h1> <h2 id="creating-admin-cluster"><a href="#creating-admin-cluster" class="header-anchor">#</a> Creating Admin Cluster</h2> <ol><li>In the following example, all service accounts are automatically
created by the bmctl create config command</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code> bmctl create config -c ***ADMIN_CLUSTER_NAME*** --enable-apis     --create-service-accounts --project-id<span class="token operator">=</span>***CLOUD_PROJECT_ID***
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p><em><strong>ADMIN_CLUSTER_NAME</strong></em>: the name of the new cluster.</p> <p><em><strong>CLOUD_PROJECT_ID</strong></em>: your Google Cloud project ID.</p></div> <ol start="2"><li>Run the below command to a config file for admin cluster named admin1 associated with project ID my-gcp-project.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code> bmctl create config -c admin1
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The file is written to bmctl-workspace/admin1/admin1.yaml.</p></div> <ol start="3"><li>Run the below command to create admin cluster.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>bmctl create cluster --c admin1
</code></pre></div><ol start="4"><li>Sample manifests file for creating admin cluster on bare metal</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> gcrKeyPath:
<span class="token operator">&gt;</span> bmctl-workspace/.sa-keys/anthos-on-proliant-dl-d46105613458.json

<span class="token operator">&gt;</span> <span class="token comment">#sshPrivateKeyPath: \&lt;path to SSH private key, used for node access\&gt;</span>

<span class="token operator">&gt;</span> sshPrivateKeyPath: /home/user/.ssh/id_rsa

<span class="token operator">&gt;</span> gkeConnectAgentServiceAccountKeyPath:
<span class="token operator">&gt;</span> bmctl-workspace/.sa-keys/anthos-on-proliant-dl-026fe05e49f6.json

<span class="token operator">&gt;</span> gkeConnectRegisterServiceAccountKeyPath:
<span class="token operator">&gt;</span> bmctl-workspace/.sa-keys/anthos-on-proliant-dl-3942a98cc261.json

<span class="token operator">&gt;</span> cloudOperationsServiceAccountKeyPath:
<span class="token operator">&gt;</span> bmctl-workspace/.sa-keys/anthos-on-proliant-dl-ee7fc370c8a3.json
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">&gt;</span> <span class="token punctuation">---</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> apiVersion<span class="token punctuation">:</span> v1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> kind<span class="token punctuation">:</span> Namespace
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> metadata<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> name<span class="token punctuation">:</span> cluster<span class="token punctuation">-</span>admin1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">---</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> apiVersion<span class="token punctuation">:</span> baremetal.cluster.gke.io/v1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> kind<span class="token punctuation">:</span> Cluster
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> metadata<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> name<span class="token punctuation">:</span> admin1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> namespace<span class="token punctuation">:</span> cluster<span class="token punctuation">-</span>admin1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> spec<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Cluster type. This can be:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># 1) admin: to create an admin cluster. This can later be used to</span>
<span class="token punctuation">&gt;</span> create user clusters.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># 2) user: to create a user cluster. Requires an existing admin</span>
<span class="token punctuation">&gt;</span> cluster.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># 3) hybrid: to create a hybrid cluster that runs admin cluster</span>
<span class="token punctuation">&gt;</span> components and user workloads.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># 4) standalone: to create a cluster that manages itself, runs user</span>
<span class="token punctuation">&gt;</span> workloads<span class="token punctuation">,</span> but does not manage other clusters.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> type<span class="token punctuation">:</span> admin
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Anthos cluster version.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> anthosBareMetalVersion<span class="token punctuation">:</span> 1.8.0
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># GKE connect configuration</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> gkeConnect<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> projectID<span class="token punctuation">:</span> anthos<span class="token punctuation">-</span>on<span class="token punctuation">-</span>proliant<span class="token punctuation">-</span>dl
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Control plane configuration</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> controlPlane<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> nodePoolSpec<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> nodes<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Control plane node pools. Typically, this is either a single</span>
<span class="token punctuation">&gt;</span> machine
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># or 3 machines if using a high availability deployment.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">-</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 20.0.61.101
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">-</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 20.0.61.102
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">-</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 20.0.61.104
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Cluster networking configuration</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> clusterNetwork<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Pods specify the IP ranges from which pod networks are allocated.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> pods<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> cidrBlocks<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">-</span> 192.168.0.0/16
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Services specify the network ranges from which service virtual IPs</span>
<span class="token punctuation">&gt;</span> are allocated.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># This can be any RFC1918 range that does not conflict with any other</span>
<span class="token punctuation">&gt;</span> IP range
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># in the cluster and node pool resources.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> services<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> cidrBlocks<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">-</span> 10.96.0.0/20
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Load balancer configuration</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> loadBalancer<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Load balancer mode can be either \'bundled\' or \'manual\'.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># In \'bundled\' mode a load balancer will be installed on load</span>
<span class="token punctuation">&gt;</span> balancer nodes during cluster creation.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># In \'manual\' mode the cluster relies on a manually-configured</span>
<span class="token punctuation">&gt;</span> external load balancer.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> mode<span class="token punctuation">:</span> bundled
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Load balancer port configuration</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> ports<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Specifies the port the load balancer serves the Kubernetes control</span>
<span class="token punctuation">&gt;</span> plane on.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># In \'manual\' mode the external load balancer must be listening on</span>
<span class="token punctuation">&gt;</span> this port.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> controlPlaneLBPort<span class="token punctuation">:</span> <span class="token number">443</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># There are two load balancer virtual IP (VIP) addresses: one for the</span>
<span class="token punctuation">&gt;</span> control plane
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># and one for the L7 Ingress service. The VIPs must be in the same</span>
<span class="token punctuation">&gt;</span> subnet as the load balancer nodes.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># These IP addresses do not correspond to physical network</span>
<span class="token punctuation">&gt;</span> interfaces.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> vips<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># ControlPlaneVIP specifies the VIP to connect to the Kubernetes API</span>
<span class="token punctuation">&gt;</span> server.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># This address must not be in the address pools below.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> controlPlaneVIP<span class="token punctuation">:</span> 20.0.61.220
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># IngressVIP specifies the VIP shared by all services for ingress</span>
<span class="token punctuation">&gt;</span> traffic.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Allowed only in non-admin clusters.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># This address must be in the address pools below.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># ingressVIP: 10.0.0.2</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># AddressPools is a list of non-overlapping IP ranges for the data</span>
<span class="token punctuation">&gt;</span> plane load balancer.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># All addresses must be in the same subnet as the load balancer</span>
<span class="token punctuation">&gt;</span> nodes.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Address pool configuration is only valid for \'bundled\' LB mode in</span>
<span class="token punctuation">&gt;</span> non<span class="token punctuation">-</span>admin clusters.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># addressPools:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># - name: pool1</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># addresses:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # Each address must be either in the CIDR form (1.2.3.0/24)</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # or range form (1.2.3.1-1.2.3.5).</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># - 10.0.0.1-10.0.0.4</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># A load balancer node pool can be configured to specify nodes used</span>
<span class="token punctuation">&gt;</span> for load balancing.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># These nodes are part of the Kubernetes cluster and run regular</span>
<span class="token punctuation">&gt;</span> workloads as well as load balancers.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># If the node pool config is absent then the control plane nodes are</span>
<span class="token punctuation">&gt;</span> used.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Node pool configuration is only valid for \'bundled\' LB mode.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># nodePoolSpec:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># nodes:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># - address: \&lt;Machine 1 IP\&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Proxy configuration</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># proxy:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># url: http://\[username:password@\]domain</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # A list of IPs, hostnames or domains that should not be proxied.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># noProxy:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># - 127.0.0.1</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># - localhost</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Logging and Monitoring</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> clusterOperations<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Cloud project for logs and metrics.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> projectID<span class="token punctuation">:</span> anthos<span class="token punctuation">-</span>on<span class="token punctuation">-</span>proliant<span class="token punctuation">-</span>dl
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Cloud location for logs and metrics.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> location<span class="token punctuation">:</span> us<span class="token punctuation">-</span>central1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Enable Cloud Audit Logging if uncommented and set to false.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># disableCloudAuditLogging: false</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Whether collection of application logs/metrics should be enabled</span>
<span class="token punctuation">&gt;</span> (in addition to
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># collection of system logs/metrics which correspond to system</span>
<span class="token punctuation">&gt;</span> components such as
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Kubernetes control plane or cluster management agents).</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># enableApplication: false</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Storage configuration</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> storage<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># lvpNodeMounts specifies the config for local PersistentVolumes</span>
<span class="token punctuation">&gt;</span> backed by mounted disks.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># These disks need to be formatted and mounted by the user, which can</span>
<span class="token punctuation">&gt;</span> be done before or after
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># cluster creation.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> lvpNodeMounts<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># path specifies the host machine path where mounted disks will be</span>
<span class="token punctuation">&gt;</span> discovered and a local PV
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># will be created for each mount.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> path<span class="token punctuation">:</span> /mnt/localpv<span class="token punctuation">-</span>disk
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># storageClassName specifies the StorageClass that PVs will be</span>
<span class="token punctuation">&gt;</span> created with. The StorageClass
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># is created during cluster creation.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> storageClassName<span class="token punctuation">:</span> local<span class="token punctuation">-</span>disks
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># lvpShare specifies the config for local PersistentVolumes backed by</span>
<span class="token punctuation">&gt;</span> subdirectories in a shared filesystem.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># These subdirectories are automatically created during cluster</span>
<span class="token punctuation">&gt;</span> creation.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> lvpShare<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># path specifies the host machine path where subdirectories will be</span>
<span class="token punctuation">&gt;</span> created on each host. A local PV
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># will be created for each subdirectory.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> path<span class="token punctuation">:</span> /mnt/localpv<span class="token punctuation">-</span>share
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># storageClassName specifies the StorageClass that PVs will be</span>
<span class="token punctuation">&gt;</span> created with. The StorageClass
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># is created during cluster creation.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> storageClassName<span class="token punctuation">:</span> local<span class="token punctuation">-</span>shared
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># numPVUnderSharedPath specifies the number of subdirectories to</span>
<span class="token punctuation">&gt;</span> create under path.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> numPVUnderSharedPath<span class="token punctuation">:</span> <span class="token number">5</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># NodeConfig specifies the configuration that applies to all nodes in</span>
<span class="token punctuation">&gt;</span> the cluster.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> nodeConfig<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># podDensity specifies the pod density configuration.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> podDensity<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># maxPodsPerNode specifies at most how many pods can be run on a</span>
<span class="token punctuation">&gt;</span> single node.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> maxPodsPerNode<span class="token punctuation">:</span> <span class="token number">250</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># containerRuntime specifies which container runtime to use for</span>
<span class="token punctuation">&gt;</span> scheduling containers on nodes.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># containerd and docker are supported.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> containerRuntime<span class="token punctuation">:</span> docker
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># KubeVirt configuration, uncomment this section if you want to</span>
<span class="token punctuation">&gt;</span> install kubevirt to the cluster
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># kubevirt:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # if useEmulation is enabled, hardware accelerator (i.e relies on</span>
<span class="token punctuation">&gt;</span> cpu feature like vmx or svm)
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # will not be attempted. QEMU will be used for software emulation.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # useEmulation must be specified for KubeVirt installation</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># useEmulation: false</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Authentication; uncomment this section if you wish to enable</span>
<span class="token punctuation">&gt;</span> authentication to the cluster with OpenID Connect.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># authentication:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># oidc:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # issuerURL specifies the URL of your OpenID provider, such as</span>
<span class="token punctuation">&gt;</span> \&quot;https<span class="token punctuation">:</span>//accounts.google.com\&quot;. The Kubernetes API
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # server uses this URL to discover public keys for verifying</span>
<span class="token punctuation">&gt;</span> tokens. Must use HTTPS.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># issuerURL: \&lt;URL for OIDC Provider; required\&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # clientID specifies the ID for the client application that makes</span>
<span class="token punctuation">&gt;</span> authentication requests to the OpenID
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # provider.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># clientID: \&lt;ID for OIDC client application; required\&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # clientSecret specifies the secret for the client application.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># clientSecret: \&lt;Secret for OIDC client application; optional\&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # kubectlRedirectURL specifies the redirect URL (required) for the</span>
<span class="token punctuation">&gt;</span> gcloud CLI<span class="token punctuation">,</span> such as
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # \&quot;http://localhost:\[PORT\]/callback\&quot;.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># kubectlRedirectURL: \&lt;Redirect URL for the gcloud CLI; optional,</span>
<span class="token punctuation">&gt;</span> default is \&quot;http<span class="token punctuation">:</span>//kubectl.redirect.invalid\&quot;\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # username specifies the JWT claim to use as the username. The</span>
<span class="token punctuation">&gt;</span> default is \&quot;sub\&quot;<span class="token punctuation">,</span> which is expected to be a
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # unique identifier of the end user.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># username: \&lt;JWT claim to use as the username; optional, default is</span>
<span class="token punctuation">&gt;</span> \&quot;sub\&quot;\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # usernamePrefix specifies the prefix prepended to username claims</span>
<span class="token punctuation">&gt;</span> to prevent clashes with existing names.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># usernamePrefix: \&lt;Prefix prepended to username claims; optional\&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # group specifies the JWT claim that the provider will use to</span>
<span class="token punctuation">&gt;</span> return your security groups.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># group: \&lt;JWT claim to use as the group name; optional\&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # groupPrefix specifies the prefix prepended to group claims to</span>
<span class="token punctuation">&gt;</span> prevent clashes with existing names.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># groupPrefix: \&lt;Prefix prepended to group claims; optional\&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # scopes specifies additional scopes to send to the OpenID</span>
<span class="token punctuation">&gt;</span> provider as a comma<span class="token punctuation">-</span>delimited list.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># scopes: \&lt;Additional scopes to send to OIDC provider as a</span>
<span class="token punctuation">&gt;</span> comma<span class="token punctuation">-</span>separated list; optional\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # extraParams specifies additional key-value parameters to send to</span>
<span class="token punctuation">&gt;</span> the OpenID provider as a comma<span class="token punctuation">-</span>delimited
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # list.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># extraParams: \&lt;Additional key-value parameters to send to OIDC</span>
<span class="token punctuation">&gt;</span> provider as a comma<span class="token punctuation">-</span>separated list; optional\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # proxy specifies the proxy server to use for the cluster to</span>
<span class="token punctuation">&gt;</span> connect to your OIDC provider<span class="token punctuation">,</span> if applicable.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # Example: https://user:password\@10.10.10.10:8888. If left blank,</span>
<span class="token punctuation">&gt;</span> this defaults to no proxy.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># proxy: \&lt;Proxy server to use for the cluster to connect to your</span>
<span class="token punctuation">&gt;</span> OIDC provider; optional<span class="token punctuation">,</span> default is no proxy\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # deployCloudConsoleProxy specifies whether to deploy a reverse</span>
<span class="token punctuation">&gt;</span> proxy in the cluster to allow Google Cloud
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # Console access to the on-premises OIDC provider for</span>
<span class="token punctuation">&gt;</span> authenticating users. If your identity provider is not
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # reachable over the public internet, and you wish to authenticate</span>
<span class="token punctuation">&gt;</span> using Google Cloud Console<span class="token punctuation">,</span> then this field
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # must be set to true. If left blank, this field defaults to</span>
<span class="token punctuation">&gt;</span> false.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># deployCloudConsoleProxy: \&lt;Whether to deploy a reverse proxy for</span>
<span class="token punctuation">&gt;</span> Google Cloud Console authentication; optional\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # certificateAuthorityData specifies a Base64 PEM-encoded</span>
<span class="token punctuation">&gt;</span> certificate authority certificate of your identity
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # provider. It\'s not needed if your identity provider\'s</span>
<span class="token punctuation">&gt;</span> certificate was issued by a well<span class="token punctuation">-</span>known public CA.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # However, if deployCloudConsoleProxy is true, then this value</span>
<span class="token punctuation">&gt;</span> must be provided<span class="token punctuation">,</span> even for a well<span class="token punctuation">-</span>known public
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # CA.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># certificateAuthorityData: \&lt;Base64 PEM-encoded certificate</span>
<span class="token punctuation">&gt;</span> authority certificate of your OIDC provider; optional\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Node access configuration; uncomment this section if you wish to</span>
<span class="token punctuation">&gt;</span> use a non<span class="token punctuation">-</span>root user
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># with passwordless sudo capability for machine login.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> nodeAccess<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> loginUser<span class="token punctuation">:</span> username
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">---</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Node pools for worker nodes</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> apiVersion<span class="token punctuation">:</span> baremetal.cluster.gke.io/v1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> kind<span class="token punctuation">:</span> NodePool
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> metadata<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> name<span class="token punctuation">:</span> node<span class="token punctuation">-</span>pool<span class="token punctuation">-</span><span class="token number">1</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> namespace<span class="token punctuation">:</span> cluster<span class="token punctuation">-</span>admin1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> spec<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> clusterName<span class="token punctuation">:</span> admin1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> nodes<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">-</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 20.0.61.105
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">-</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 20.0.61.106

</code></pre></div><h4 id="logging-in-to-a-cluster-from-the-cloud-console"><a href="#logging-in-to-a-cluster-from-the-cloud-console" class="header-anchor">#</a> Logging in to a cluster from the Cloud Console</h4> <ol><li><p>export k= bmctl-workspace/admin5/admin5-kubeconfig</p></li> <li><p>kubectl create serviceaccount <em><strong>googleanthos</strong></em> --kubeconfig $k</p></li> <li><p>kubectl create clusterrolebinding <em><strong>cluster-user</strong></em> --clusterrole
view --serviceaccount default:<em><strong>googleanthos</strong></em> --kubeconfig $k</p></li> <li><p>kubectl get serviceaccounts --kubeconfig $k</p></li> <li><p>kubectl describe serviceaccounts <em><strong>googleanthos</strong></em> --kubeconfig $k</p></li> <li><p>kubectl create clusterrolebinding <em><strong>cluster-user-googleanthos</strong></em>
--clusterrole view --serviceaccount default:<em><strong>googleanthos</strong></em>
--kubeconfig $k</p></li> <li><p>kubectl create clusterrolebinding <em><strong>addon-cluster-admin5</strong></em>
--clusterrole cloud-console-reader --serviceaccount
default:<em><strong>googleanthos</strong></em> --kubeconfig $k</p></li> <li><p>TOKENNAME=`kubectl get serviceaccount/<em><strong>googleanthos</strong></em> -o
jsonpath='{.secrets[0].name}' --kubeconfig $k</p></li> <li><p>kubectl get secret $TOKENNAME -o jsonpath='{.data.token}' --$k
| base64 --decode</p></li></ol> <p>here token will be generated copy and paste in the gcloud console</p> <ol start="10"><li>On Google cloude console, Navigate to admin cluster and click on
nodes, it will displays as follows</li></ol> <p><img src="/hpe-solutions-googleanthos/1.8/assets/img/image16.55857a30.png" alt=""></p> <h2 id="creating-user-cluster"><a href="#creating-user-cluster" class="header-anchor">#</a> Creating User Cluster</h2> <ol><li>Create a user cluster config file with the bmctl create
config command:</li></ol> <p>bmctl create config -c <em><strong>USER_CLUSTER_NAME</strong></em></p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <blockquote><p>The file is written to bmctl-workspace/user1/user1.yaml. The generic
path to the file is bmctl-workspace/<em><strong>CLUSTER
NAME</strong></em>/<em><strong>CLUSTER_NAME.yaml</strong></em></p></blockquote></div> <ol start="2"><li>Issue the bmctl command to apply the user cluster config and create
the cluster:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>bmctl create cluster -c ***USER_CLUSTER_NAME*** --kubeconfig ***ADMIN_KUBECONFIG***
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p><em><strong>USER_CLUSTER_NAME</strong></em>: the cluster name created in the previous section.</p> <p><em><strong>ADMIN_KUBECONFIG</strong></em>: the path to the admin cluster kubeconfig file.</p></div> <ol start="3"><li>Sample user.yaml file is as below.</li></ol> <blockquote><p>bmctl configuration variables. Because this section is valid YAML but not a valid Kubernetes resource, this section can only be included when using bmctl to create the initial admin/hybrid cluster. Afterwards, when creating user clusters by directly applying the cluster and node pool resources to the existing cluster, you must remove this section.</p></blockquote> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment">#gcrKeyPath: \&lt;path to GCR service account key\&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment">#sshPrivateKeyPath: \&lt;path to SSH private key, used for node access\&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment">#sshPrivateKeyPath: /home/user/.ssh/id_rsa</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment">#gkeConnectAgentServiceAccountKeyPath: \&lt;path to Connect agent</span>
<span class="token punctuation">&gt;</span> service account key\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment">#gkeConnectRegisterServiceAccountKeyPath: \&lt;path to Hub registration</span>
<span class="token punctuation">&gt;</span> service account key\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment">#cloudOperationsServiceAccountKeyPath: \&lt;path to Cloud Operations</span>
<span class="token punctuation">&gt;</span> service account key\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">---</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> apiVersion<span class="token punctuation">:</span> v1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> kind<span class="token punctuation">:</span> Namespace
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> metadata<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> name<span class="token punctuation">:</span> cluster<span class="token punctuation">-</span>user1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">---</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> apiVersion<span class="token punctuation">:</span> baremetal.cluster.gke.io/v1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> kind<span class="token punctuation">:</span> Cluster
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> metadata<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> name<span class="token punctuation">:</span> user1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> namespace<span class="token punctuation">:</span> cluster<span class="token punctuation">-</span>user1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> spec<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Cluster type. This can be:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># 1) admin: to create an admin cluster. This can later be used to</span>
<span class="token punctuation">&gt;</span> create user clusters.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># 2) user: to create a user cluster. Requires an existing admin</span>
<span class="token punctuation">&gt;</span> cluster.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># 3) hybrid: to create a hybrid cluster that runs admin cluster</span>
<span class="token punctuation">&gt;</span> components and user workloads.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># 4) standalone: to create a cluster that manages itself, runs user</span>
<span class="token punctuation">&gt;</span> workloads<span class="token punctuation">,</span> but does not manage other clusters.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> type<span class="token punctuation">:</span> user
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Anthos cluster version.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> anthosBareMetalVersion<span class="token punctuation">:</span> 1.8.0
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># GKE connect configuration</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> gkeConnect<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> projectID<span class="token punctuation">:</span> anthos<span class="token punctuation">-</span>on<span class="token punctuation">-</span>proliant<span class="token punctuation">-</span>dl
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Control plane configuration</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> controlPlane<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> nodePoolSpec<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> nodes<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Control plane node pools. Typically, this is either a single</span>
<span class="token punctuation">&gt;</span> machine
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># or 3 machines if using a high availability deployment.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">-</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 20.0.61.108
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Cluster networking configuration</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> clusterNetwork<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Pods specify the IP ranges from which pod networks are allocated.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> pods<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> cidrBlocks<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">-</span> 192.168.0.0/16
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Services specify the network ranges from which service virtual IPs</span>
<span class="token punctuation">&gt;</span> are allocated.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># This can be any RFC1918 range that does not conflict with any other</span>
<span class="token punctuation">&gt;</span> IP range
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># in the cluster and node pool resources.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> services<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> cidrBlocks<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">-</span> 10.96.0.0/20
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Load balancer configuration</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> loadBalancer<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> mode<span class="token punctuation">:</span> bundled
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> ports<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> controlPlaneLBPort<span class="token punctuation">:</span> <span class="token number">443</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> vips<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> controlPlaneVIP<span class="token punctuation">:</span> 20.0.61.236
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> ingressVIP<span class="token punctuation">:</span> 20.0.61.237
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> addressPools<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> pool1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> addresses<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">-</span> 20.0.61.237<span class="token punctuation">-</span>20.0.61.250
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> clusterOperations<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Cloud project for logs and metrics.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> projectID<span class="token punctuation">:</span> anthos<span class="token punctuation">-</span>on<span class="token punctuation">-</span>proliant<span class="token punctuation">-</span>dl
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Cloud location for logs and metrics.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> location<span class="token punctuation">:</span> us<span class="token punctuation">-</span>central1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Enable Cloud Audit Logging if uncommented and set to false.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># disableCloudAuditLogging: false</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Whether collection of application logs/metrics should be enabled</span>
<span class="token punctuation">&gt;</span> (in addition to
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># collection of system logs/metrics which correspond to system</span>
<span class="token punctuation">&gt;</span> components such as
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Kubernetes control plane or cluster management agents).</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># enableApplication: false</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Storage configuration</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> storage<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># lvpNodeMounts specifies the config for local PersistentVolumes</span>
<span class="token punctuation">&gt;</span> backed by mounted disks.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># These disks need to be formatted and mounted by the user, which can</span>
<span class="token punctuation">&gt;</span> be done before or after
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># cluster creation.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> lvpNodeMounts<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># path specifies the host machine path where mounted disks will be</span>
<span class="token punctuation">&gt;</span> discovered and a local PV
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># will be created for each mount.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> path<span class="token punctuation">:</span> /mnt/localpv<span class="token punctuation">-</span>disk
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># storageClassName specifies the StorageClass that PVs will be</span>
<span class="token punctuation">&gt;</span> created with. The StorageClass
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># is created during cluster creation.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> storageClassName<span class="token punctuation">:</span> local<span class="token punctuation">-</span>disks
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># lvpShare specifies the config for local PersistentVolumes backed by</span>
<span class="token punctuation">&gt;</span> subdirectories in a shared filesystem.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># These subdirectories are automatically created during cluster</span>
<span class="token punctuation">&gt;</span> creation.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> lvpShare<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># path specifies the host machine path where subdirectories will be</span>
<span class="token punctuation">&gt;</span> created on each host. A local PV
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># will be created for each subdirectory.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> path<span class="token punctuation">:</span> /mnt/localpv<span class="token punctuation">-</span>share
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># storageClassName specifies the StorageClass that PVs will be</span>
<span class="token punctuation">&gt;</span> created with. The StorageClass
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># is created during cluster creation.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> storageClassName<span class="token punctuation">:</span> local<span class="token punctuation">-</span>shared
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># numPVUnderSharedPath specifies the number of subdirectories to</span>
<span class="token punctuation">&gt;</span> create under path.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> numPVUnderSharedPath<span class="token punctuation">:</span> <span class="token number">5</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># NodeConfig specifies the configuration that applies to all nodes in</span>
<span class="token punctuation">&gt;</span> the cluster.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> nodeConfig<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># podDensity specifies the pod density configuration.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> podDensity<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># maxPodsPerNode specifies at most how many pods can be run on a</span>
<span class="token punctuation">&gt;</span> single node.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> maxPodsPerNode<span class="token punctuation">:</span> <span class="token number">250</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># containerRuntime specifies which container runtime to use for</span>
<span class="token punctuation">&gt;</span> scheduling containers on nodes.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># containerd and docker are supported.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> containerRuntime<span class="token punctuation">:</span> docker
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># KubeVirt configuration, uncomment this section if you want to</span>
<span class="token punctuation">&gt;</span> install kubevirt to the cluster
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># kubevirt:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # if useEmulation is enabled, hardware accelerator (i.e relies on</span>
<span class="token punctuation">&gt;</span> cpu feature like vmx or svm)
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # will not be attempted. QEMU will be used for software emulation.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # useEmulation must be specified for KubeVirt installation</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># useEmulation: false</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Authentication; uncomment this section if you wish to enable</span>
<span class="token punctuation">&gt;</span> authentication to the cluster with OpenID Connect.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># authentication:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># oidc:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # issuerURL specifies the URL of your OpenID provider, such as</span>
<span class="token punctuation">&gt;</span> \&quot;https<span class="token punctuation">:</span>//accounts.google.com\&quot;. The Kubernetes API
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # server uses this URL to discover public keys for verifying</span>
<span class="token punctuation">&gt;</span> tokens. Must use HTTPS.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># issuerURL: \&lt;URL for OIDC Provider; required\&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # clientID specifies the ID for the client application that makes</span>
<span class="token punctuation">&gt;</span> authentication requests to the OpenID
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # provider.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># clientID: \&lt;ID for OIDC client application; required\&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # clientSecret specifies the secret for the client application.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># clientSecret: \&lt;Secret for OIDC client application; optional\&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # kubectlRedirectURL specifies the redirect URL (required) for the</span>
<span class="token punctuation">&gt;</span> gcloud CLI<span class="token punctuation">,</span> such as
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # \&quot;http://localhost:\[PORT\]/callback\&quot;.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># kubectlRedirectURL: \&lt;Redirect URL for the gcloud CLI; optional,</span>
<span class="token punctuation">&gt;</span> default is \&quot;http<span class="token punctuation">:</span>//kubectl.redirect.invalid\&quot;\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # username specifies the JWT claim to use as the username. The</span>
<span class="token punctuation">&gt;</span> default is \&quot;sub\&quot;<span class="token punctuation">,</span> which is expected to be a
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # unique identifier of the end user.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># username: \&lt;JWT claim to use as the username; optional, default is</span>
<span class="token punctuation">&gt;</span> \&quot;sub\&quot;\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # usernamePrefix specifies the prefix prepended to username claims</span>
<span class="token punctuation">&gt;</span> to prevent clashes with existing names.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># usernamePrefix: \&lt;Prefix prepended to username claims; optional\&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # group specifies the JWT claim that the provider will use to</span>
<span class="token punctuation">&gt;</span> return your security groups.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># group: \&lt;JWT claim to use as the group name; optional\&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # groupPrefix specifies the prefix prepended to group claims to</span>
<span class="token punctuation">&gt;</span> prevent clashes with existing names.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># groupPrefix: \&lt;Prefix prepended to group claims; optional\&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # scopes specifies additional scopes to send to the OpenID</span>
<span class="token punctuation">&gt;</span> provider as a comma<span class="token punctuation">-</span>delimited list.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># scopes: \&lt;Additional scopes to send to OIDC provider as a</span>
<span class="token punctuation">&gt;</span> comma<span class="token punctuation">-</span>separated list; optional\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # extraParams specifies additional key-value parameters to send to</span>
<span class="token punctuation">&gt;</span> the OpenID provider as a comma<span class="token punctuation">-</span>delimited
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # list.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># extraParams: \&lt;Additional key-value parameters to send to OIDC</span>
<span class="token punctuation">&gt;</span> provider as a comma<span class="token punctuation">-</span>separated list; optional\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # proxy specifies the proxy server to use for the cluster to</span>
<span class="token punctuation">&gt;</span> connect to your OIDC provider<span class="token punctuation">,</span> if applicable.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # Example: https://user:password\@10.10.10.10:8888. If left blank,</span>
<span class="token punctuation">&gt;</span> this defaults to no proxy.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># proxy: \&lt;Proxy server to use for the cluster to connect to your</span>
<span class="token punctuation">&gt;</span> OIDC provider; optional<span class="token punctuation">,</span> default is no proxy\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # deployCloudConsoleProxy specifies whether to deploy a reverse</span>
<span class="token punctuation">&gt;</span> proxy in the cluster to allow Google Cloud
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # Console access to the on-premises OIDC provider for</span>
<span class="token punctuation">&gt;</span> authenticating users. If your identity provider is not
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # reachable over the public internet, and you wish to authenticate</span>
<span class="token punctuation">&gt;</span> using Google Cloud Console<span class="token punctuation">,</span> then this field
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # must be set to true. If left blank, this field defaults to</span>
<span class="token punctuation">&gt;</span> false.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># deployCloudConsoleProxy: \&lt;Whether to deploy a reverse proxy for</span>
<span class="token punctuation">&gt;</span> Google Cloud Console authentication; optional\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # certificateAuthorityData specifies a Base64 PEM-encoded</span>
<span class="token punctuation">&gt;</span> certificate authority certificate of your identity
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # provider. It\'s not needed if your identity provider\'s</span>
<span class="token punctuation">&gt;</span> certificate was issued by a well<span class="token punctuation">-</span>known public CA.
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # However, if deployCloudConsoleProxy is true, then this value</span>
<span class="token punctuation">&gt;</span> must be provided<span class="token punctuation">,</span> even for a well<span class="token punctuation">-</span>known public
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># # CA.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># certificateAuthorityData: \&lt;Base64 PEM-encoded certificate</span>
<span class="token punctuation">&gt;</span> authority certificate of your OIDC provider; optional\<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Node access configuration; uncomment this section if you wish to</span>
<span class="token punctuation">&gt;</span> use a non<span class="token punctuation">-</span>root user
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># with passwordless sudo capability for machine login.</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> nodeAccess<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> loginUser<span class="token punctuation">:</span> username
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">---</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token comment"># Node pools for worker nodes</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> apiVersion<span class="token punctuation">:</span> baremetal.cluster.gke.io/v1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> kind<span class="token punctuation">:</span> NodePool
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> metadata<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> name<span class="token punctuation">:</span> node<span class="token punctuation">-</span>pool<span class="token punctuation">-</span><span class="token number">1</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> namespace<span class="token punctuation">:</span> cluster<span class="token punctuation">-</span>user1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> spec<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> clusterName<span class="token punctuation">:</span> user1
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> nodes<span class="token punctuation">:</span>
<span class="token punctuation">&gt;</span>
<span class="token punctuation">&gt;</span> <span class="token punctuation">-</span> <span class="token key atrule">address</span><span class="token punctuation">:</span> 20.0.61.107

</code></pre></div><h4 id="logging-in-to-a-cluster-from-the-cloud-console-2"><a href="#logging-in-to-a-cluster-from-the-cloud-console-2" class="header-anchor">#</a> Logging in to a cluster from the Cloud Console</h4> <ol><li><p>export k= bmctl-workspace/user1/user1-kubeconfig</p></li> <li><p>kubectl create serviceaccount <em><strong>googleanthos</strong></em> --kubeconfig $k</p></li> <li><p>kubectl create clusterrolebinding <em><strong>cluster-user</strong></em> --clusterrole
view --serviceaccount default:<em><strong>googleanthos</strong></em> --kubeconfig $k</p></li> <li><p>kubectl get serviceaccounts --kubeconfig $k</p></li> <li><p>kubectl describe serviceaccounts <em><strong>googleanthos</strong></em> --kubeconfig $k</p></li> <li><p>kubectl create clusterrolebinding <em><strong>cluster-user-googleanthos</strong></em>
--clusterrole view --serviceaccount default:<em><strong>googleanthos</strong></em>
--kubeconfig $k</p></li> <li><p>kubectl create clusterrolebinding <em><strong>addon-cluster-admin5</strong></em>
--clusterrole cloud-console-reader --serviceaccount
default:<em><strong>googleanthos</strong></em> --kubeconfig $k</p></li> <li><p>TOKENNAME=`kubectl get serviceaccount/<em><strong>googleanthos</strong></em> -o
jsonpath='{.secrets[0].name}' --kubeconfig $k</p></li> <li><p>kubectl get secret $TOKENNAME -o jsonpath='{.data.token}' --$k
| base64 --decode</p></li></ol> <p>here token will be generated copy and paste in the gcloud console</p> <ol start="10"><li>Once logged into the user cluster, click on nodes it will displays
as follows.</li></ol> <p><img src="/hpe-solutions-googleanthos/1.8/assets/img/image17.4b681194.png" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-googleanthos/1.8/Solution-Deployment/Host-configuration.html" class="prev">
        Host Configuration
      </a></span> <span class="next"><a href="/hpe-solutions-googleanthos/1.8/Resosurces-and-additional-links/Resources.html">
        Resosurces and additional links
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-googleanthos/1.8/assets/js/app.9bbc654e.js" defer></script><script src="/hpe-solutions-googleanthos/1.8/assets/js/2.0cd4e70b.js" defer></script><script src="/hpe-solutions-googleanthos/1.8/assets/js/7.05a6c413.js" defer></script>
  </body>
</html>
